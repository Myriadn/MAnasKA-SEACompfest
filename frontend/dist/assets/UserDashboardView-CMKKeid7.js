import{_ as Y,A as W,f as G,a as o,g as D,b as t,r as C,h as v,d as c,w as O,F as f,i as w,t as a,n as m,j as M,v as P,k as A,l as b,c as q,m as J,S,o as i}from"./index-DwfcnRQA.js";const K={name:"UserDashboardView",components:{AppHeader:G,AppFooter:W},setup(){const h=b([]),s=b(!1),u=b(null),l=b(!1),y=b(!1),x=b(!1),g=b(!1),d=b({start:null,end:null}),p=b(""),e=new Date().toISOString().substring(0,10),r=q(()=>d.value.start&&d.value.end&&d.value.start<=d.value.end),k=async()=>{s.value=!0;try{const n=await S.getSubscriptions();h.value=n}catch(n){console.error("Error loading subscriptions:",n)}finally{s.value=!1}},B=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),F=n=>{const L={year:"numeric",month:"short",day:"numeric"};return new Date(n).toLocaleDateString("en-US",L)},N=n=>{u.value=n,l.value=!0},T=()=>{l.value=!1,u.value=null},U=n=>{u.value=n,d.value={start:e,end:null},y.value=!0},_=()=>{y.value=!1,d.value={start:null,end:null}},I=async()=>{if(r.value)try{await S.pauseSubscription(u.value.id,d.value.start,d.value.end),await k(),_()}catch(n){console.error("Error pausing subscription:",n)}},j=n=>{u.value=n,p.value="",x.value=!0},R=()=>{x.value=!1,p.value=""},z=async()=>{try{await S.cancelSubscription(u.value.id,p.value),await k(),R()}catch(n){console.error("Error cancelling subscription:",n)}},E=n=>{u.value=n,g.value=!0},V=()=>{g.value=!1},H=async()=>{try{await S.reactivateSubscription(u.value.id),await k(),V()}catch(n){console.error("Error reactivating subscription:",n)}};return J(()=>{k()}),{subscriptions:h,isLoading:s,selectedSubscription:u,showDetailsModal:l,showPauseModal:y,showCancelModal:x,showReactivateModal:g,pauseDates:d,cancellationReason:p,today:e,isPauseValid:r,formatPrice:B,formatDate:F,viewDetails:N,closeDetailsModal:T,pauseSubscription:U,closePauseModal:_,confirmPause:I,cancelSubscription:j,closeCancelModal:R,confirmCancel:z,reactivateSubscription:E,closeReactivateModal:V,confirmReactivate:H}}},Q={class:"min-h-screen flex flex-col"},X={class:"container mx-auto px-4 py-8"},Z={key:0,class:"alert alert-info mb-6"},$={class:"card bg-base-100 shadow-xl mb-8"},tt={class:"card-body"},st={key:0,class:"overflow-x-auto"},lt={class:"table w-full"},et={class:"badge badge-primary"},nt={class:"flex flex-wrap gap-1"},ot={class:"flex flex-wrap gap-1"},at={class:"font-bold"},it={class:"flex space-x-2"},rt=["onClick"],dt=["onClick"],ct=["onClick"],ut=["onClick"],bt={class:"modal-box max-w-2xl"},vt={key:0,class:"space-y-4"},mt={class:"grid grid-cols-2 gap-4"},pt={key:0},gt={class:"grid grid-cols-7 gap-2"},ft={class:"flex gap-2"},wt={key:0,class:"mt-4"},yt={class:"modal-action"},xt={class:"modal-box"},kt={class:"form-control mb-4"},St=["min"],ht={class:"form-control mb-6"},Dt=["min"],Ct={class:"modal-action"},Mt=["disabled"],Pt={class:"modal-box"},_t={class:"form-control mb-4"},Rt={class:"modal-action"},Vt={class:"modal-box"},At={class:"modal-action"};function Bt(h,s,u,l,y,x){const g=C("AppHeader"),d=C("router-link"),p=C("AppFooter");return i(),o("div",Q,[D(g),t("div",X,[s[16]||(s[16]=t("h1",{class:"text-3xl font-bold mb-8"},"My Subscriptions Dashboard",-1)),l.subscriptions.length===0?(i(),o("div",Z,[s[13]||(s[13]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",null,[s[11]||(s[11]=c("You don't have any active subscriptions. ")),D(d,{to:"/subscription",class:"underline"},{default:O(()=>s[10]||(s[10]=[c("Subscribe now")])),_:1,__:[10]}),s[12]||(s[12]=c(" to get started!"))])])):v("",!0),t("div",$,[t("div",tt,[s[15]||(s[15]=t("h2",{class:"card-title"},"Active Subscriptions",-1)),l.subscriptions.length>0?(i(),o("div",st,[t("table",lt,[s[14]||(s[14]=t("thead",null,[t("tr",null,[t("th",null,"Plan"),t("th",null,"Start Date"),t("th",null,"Meal Types"),t("th",null,"Delivery Days"),t("th",null,"Total Price"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(i(!0),o(f,null,w(l.subscriptions,e=>(i(),o("tr",{key:e.id},[t("td",null,[t("span",et,a(e.plan),1)]),t("td",null,a(l.formatDate(e.created_at)),1),t("td",null,[t("div",nt,[(i(!0),o(f,null,w(e.meal_types,r=>(i(),o("span",{key:r,class:"badge badge-ghost"},a(r),1))),128))])]),t("td",null,[t("div",ot,[(i(!0),o(f,null,w(e.days,r=>(i(),o("span",{key:r,class:"badge badge-accent"},a(r.substring(0,3)),1))),128))])]),t("td",at,a(l.formatPrice(e.total_price)),1),t("td",null,[t("span",{class:m(["badge",{"badge-success":e.status==="active","badge-warning":e.status==="paused","badge-error":e.status==="cancelled"}])},a(e.status||"active"),3)]),t("td",null,[t("div",it,[t("button",{onClick:r=>l.viewDetails(e),class:"btn btn-ghost btn-xs"}," Details ",8,rt),e.status!=="paused"&&e.status!=="cancelled"?(i(),o("button",{key:0,onClick:r=>l.pauseSubscription(e),class:"btn btn-warning btn-xs"}," Pause ",8,dt)):v("",!0),e.status!=="cancelled"?(i(),o("button",{key:1,onClick:r=>l.cancelSubscription(e),class:"btn btn-error btn-xs"}," Cancel ",8,ct)):v("",!0),e.status==="cancelled"?(i(),o("button",{key:2,onClick:r=>l.reactivateSubscription(e),class:"btn btn-success btn-xs"}," Reactivate ",8,ut)):v("",!0)])])]))),128))])])])):v("",!0)])])]),t("div",{class:m(["modal",{"modal-open":l.showDetailsModal}])},[t("div",bt,[s[33]||(s[33]=t("h3",{class:"font-bold text-2xl mb-4"},"Subscription Details",-1)),l.selectedSubscription?(i(),o("div",vt,[t("div",mt,[t("div",null,[s[20]||(s[20]=t("h4",{class:"font-bold text-lg"},"Customer Information",-1)),t("p",null,[s[17]||(s[17]=t("strong",null,"Name:",-1)),c(" "+a(l.selectedSubscription.name),1)]),t("p",null,[s[18]||(s[18]=t("strong",null,"Phone:",-1)),c(" "+a(l.selectedSubscription.phone),1)]),l.selectedSubscription.allergies?(i(),o("p",pt,[s[19]||(s[19]=t("strong",null,"Allergies:",-1)),c(" "+a(l.selectedSubscription.allergies),1)])):v("",!0)]),t("div",null,[s[25]||(s[25]=t("h4",{class:"font-bold text-lg"},"Plan Details",-1)),t("p",null,[s[21]||(s[21]=t("strong",null,"Plan:",-1)),c(" "+a(l.selectedSubscription.plan),1)]),t("p",null,[s[22]||(s[22]=t("strong",null,"Total Price:",-1)),c(" "+a(l.formatPrice(l.selectedSubscription.total_price)),1)]),t("p",null,[s[23]||(s[23]=t("strong",null,"Start Date:",-1)),c(" "+a(l.formatDate(l.selectedSubscription.created_at)),1)]),t("p",null,[s[24]||(s[24]=t("strong",null,"Status:",-1)),t("span",{class:m(["badge",{"badge-success":l.selectedSubscription.status==="active","badge-warning":l.selectedSubscription.status==="paused","badge-error":l.selectedSubscription.status==="cancelled"}])},a(l.selectedSubscription.status||"active"),3)])])]),s[31]||(s[31]=t("div",{class:"divider"},null,-1)),t("div",null,[s[26]||(s[26]=t("h4",{class:"font-bold text-lg mb-2"},"Delivery Schedule",-1)),t("div",gt,[(i(),o(f,null,w(["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],e=>t("div",{key:e,class:m(["text-center p-2 rounded border",{"bg-primary text-white":l.selectedSubscription.days.includes(e),"bg-base-200":!l.selectedSubscription.days.includes(e)}])},a(e.substring(0,3)),3)),64))])]),s[32]||(s[32]=t("div",{class:"divider"},null,-1)),t("div",null,[s[27]||(s[27]=t("h4",{class:"font-bold text-lg mb-2"},"Meal Types",-1)),t("div",ft,[(i(),o(f,null,w(["breakfast","lunch","dinner"],e=>t("div",{key:e,class:m(["badge badge-lg",{"badge-primary":l.selectedSubscription.meal_types.includes(e),"badge-ghost":!l.selectedSubscription.meal_types.includes(e)}])},a(e),3)),64))])]),l.selectedSubscription.pause_start&&l.selectedSubscription.pause_end?(i(),o("div",wt,[s[30]||(s[30]=t("h4",{class:"font-bold text-lg mb-2"},"Pause Information",-1)),t("p",null,[s[28]||(s[28]=t("strong",null,"Paused From:",-1)),c(" "+a(l.formatDate(l.selectedSubscription.pause_start)),1)]),t("p",null,[s[29]||(s[29]=t("strong",null,"Paused Until:",-1)),c(" "+a(l.formatDate(l.selectedSubscription.pause_end)),1)])])):v("",!0)])):v("",!0),t("div",yt,[t("button",{class:"btn",onClick:s[0]||(s[0]=(...e)=>l.closeDetailsModal&&l.closeDetailsModal(...e))},"Close")])])],2),t("div",{class:m(["modal",{"modal-open":l.showPauseModal}])},[t("div",xt,[s[36]||(s[36]=t("h3",{class:"font-bold text-lg mb-4"},"Pause Subscription",-1)),s[37]||(s[37]=t("p",{class:"mb-4"},"Select the period when you want to pause your meal delivery:",-1)),t("div",kt,[s[34]||(s[34]=t("label",{class:"label"},[t("span",{class:"label-text"},"Pause from")],-1)),M(t("input",{type:"date",class:"input input-bordered w-full","onUpdate:modelValue":s[1]||(s[1]=e=>l.pauseDates.start=e),min:l.today},null,8,St),[[P,l.pauseDates.start]])]),t("div",ht,[s[35]||(s[35]=t("label",{class:"label"},[t("span",{class:"label-text"},"Pause until")],-1)),M(t("input",{type:"date",class:"input input-bordered w-full","onUpdate:modelValue":s[2]||(s[2]=e=>l.pauseDates.end=e),min:l.pauseDates.start||l.today},null,8,Dt),[[P,l.pauseDates.end]])]),s[38]||(s[38]=t("div",{class:"alert alert-info mb-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("span",null,"While paused, no charges will be applied and deliveries will be suspended.")],-1)),t("div",Ct,[t("button",{class:"btn btn-ghost",onClick:s[3]||(s[3]=(...e)=>l.closePauseModal&&l.closePauseModal(...e))},"Cancel"),t("button",{class:"btn btn-warning",onClick:s[4]||(s[4]=(...e)=>l.confirmPause&&l.confirmPause(...e)),disabled:!l.isPauseValid}," Pause Subscription ",8,Mt)])])],2),t("div",{class:m(["modal",{"modal-open":l.showCancelModal}])},[t("div",Pt,[s[40]||(s[40]=A('<h3 class="font-bold text-lg mb-4">Cancel Subscription</h3><p class="mb-4">Are you sure you want to cancel your subscription?</p><div class="alert alert-error mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>This action cannot be undone. Your meal delivery will stop immediately.</span></div>',3)),t("div",_t,[s[39]||(s[39]=t("label",{class:"label"},[t("span",{class:"label-text"},"Please tell us why you're cancelling (optional)")],-1)),M(t("textarea",{class:"textarea textarea-bordered h-24","onUpdate:modelValue":s[5]||(s[5]=e=>l.cancellationReason=e)},null,512),[[P,l.cancellationReason]])]),t("div",Rt,[t("button",{class:"btn btn-ghost",onClick:s[6]||(s[6]=(...e)=>l.closeCancelModal&&l.closeCancelModal(...e))},"Go Back"),t("button",{class:"btn btn-error",onClick:s[7]||(s[7]=(...e)=>l.confirmCancel&&l.confirmCancel(...e))},"Confirm Cancellation")])])],2),t("div",{class:m(["modal",{"modal-open":l.showReactivateModal}])},[t("div",Vt,[s[41]||(s[41]=A('<h3 class="font-bold text-lg mb-4">Reactivate Subscription</h3><p class="mb-4">Would you like to reactivate your cancelled subscription?</p><div class="alert alert-success mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>Your meal delivery service will resume immediately upon reactivation.</span></div>',3)),t("div",At,[t("button",{class:"btn btn-ghost",onClick:s[8]||(s[8]=(...e)=>l.closeReactivateModal&&l.closeReactivateModal(...e))},"Cancel"),t("button",{class:"btn btn-success",onClick:s[9]||(s[9]=(...e)=>l.confirmReactivate&&l.confirmReactivate(...e))},"Confirm Reactivation")])])],2),D(p)])}const Nt=Y(K,[["render",Bt]]);export{Nt as default};

import{_ as Y,B as W,h as G,A as O,c as a,b as S,a as s,r as h,f as v,d as u,w as q,F as f,j as w,t as o,n as m,k as M,v as P,g as V,l as b,e as J,m as K,S as D,o as i}from"./index-D2pw0bkD.js";const Q={name:"UserDashboardView",components:{AppHeader:O,AppFooter:G,BreadcrumbsDashboard:W},setup(){const C=b([]),t=b(!1),c=b(null),l=b(!1),y=b(!1),x=b(!1),g=b(!1),d=b({start:null,end:null}),p=b(""),k=new Date().toISOString().substring(0,10),e=J(()=>d.value.start&&d.value.end&&d.value.start<=d.value.end),r=async()=>{t.value=!0;try{const n=await D.getSubscriptions();C.value=n}catch(n){console.error("Error loading subscriptions:",n)}finally{t.value=!1}},A=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),F=n=>{const L={year:"numeric",month:"short",day:"numeric"};return new Date(n).toLocaleDateString("en-US",L)},N=n=>{c.value=n,l.value=!0},T=()=>{l.value=!1,c.value=null},U=n=>{c.value=n,d.value={start:k,end:null},y.value=!0},_=()=>{y.value=!1,d.value={start:null,end:null}},I=async()=>{if(e.value)try{await D.pauseSubscription(c.value.id,d.value.start,d.value.end),await r(),_()}catch(n){console.error("Error pausing subscription:",n)}},j=n=>{c.value=n,p.value="",x.value=!0},R=()=>{x.value=!1,p.value=""},z=async()=>{try{await D.cancelSubscription(c.value.id,p.value),await r(),R()}catch(n){console.error("Error cancelling subscription:",n)}},E=n=>{c.value=n,g.value=!0},B=()=>{g.value=!1},H=async()=>{try{await D.reactivateSubscription(c.value.id),await r(),B()}catch(n){console.error("Error reactivating subscription:",n)}};return K(()=>{r()}),{subscriptions:C,isLoading:t,selectedSubscription:c,showDetailsModal:l,showPauseModal:y,showCancelModal:x,showReactivateModal:g,pauseDates:d,cancellationReason:p,today:k,isPauseValid:e,formatPrice:A,formatDate:F,viewDetails:N,closeDetailsModal:T,pauseSubscription:U,closePauseModal:_,confirmPause:I,cancelSubscription:j,closeCancelModal:R,confirmCancel:z,reactivateSubscription:E,closeReactivateModal:B,confirmReactivate:H}}},X={class:"min-h-screen flex flex-col"},Z={class:"container mx-auto px-4 py-8"},$={key:0,class:"alert alert-info mb-6"},ss={class:"card bg-base-100 shadow-xl mb-8"},ts={class:"card-body"},ls={key:0,class:"overflow-x-auto"},es={class:"table w-full"},ns={class:"plan-badge"},as={class:"flex flex-wrap gap-1"},os={class:"flex flex-wrap gap-1"},is={class:"font-bold"},rs={class:"flex space-x-2"},ds=["onClick"],cs=["onClick"],us=["onClick"],bs=["onClick"],vs={class:"modal-box max-w-2xl"},ms={key:0,class:"space-y-4"},ps={class:"grid grid-cols-2 gap-4"},gs={key:0},fs={class:"plan-badge"},ws={class:"grid grid-cols-7 gap-2"},ys={class:"flex gap-2"},xs={key:0,class:"mt-4"},ks={class:"modal-action"},Ss={class:"modal-box"},hs={class:"form-control mb-4"},Ds=["min"],Cs={class:"form-control mb-6"},Ms=["min"],Ps={class:"modal-action"},_s=["disabled"],Rs={class:"modal-box"},Bs={class:"form-control mb-4"},Vs={class:"modal-action"},As={class:"modal-box"},Fs={class:"modal-action"};function Ns(C,t,c,l,y,x){const g=h("AppHeader"),d=h("BreadcrumbsDashboard"),p=h("router-link"),k=h("AppFooter");return i(),a("div",X,[S(g),s("div",Z,[S(d),t[16]||(t[16]=s("h1",{class:"text-3xl font-bold mb-8"},"My Subscriptions Dashboard",-1)),l.subscriptions.length===0?(i(),a("div",$,[t[13]||(t[13]=s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("span",null,[t[11]||(t[11]=u("You don't have any active subscriptions. ")),S(p,{to:"/subscription",class:"underline"},{default:q(()=>t[10]||(t[10]=[u("Subscribe now")])),_:1,__:[10]}),t[12]||(t[12]=u(" to get started!"))])])):v("",!0),s("div",ss,[s("div",ts,[t[15]||(t[15]=s("h2",{class:"card-title"},"Active Subscriptions",-1)),l.subscriptions.length>0?(i(),a("div",ls,[s("table",es,[t[14]||(t[14]=s("thead",null,[s("tr",null,[s("th",null,"Plan"),s("th",null,"Start Date"),s("th",null,"Meal Types"),s("th",null,"Delivery Days"),s("th",null,"Total Price"),s("th",null,"Status"),s("th",null,"Actions")])],-1)),s("tbody",null,[(i(!0),a(f,null,w(l.subscriptions,e=>(i(),a("tr",{key:e.id},[s("td",null,[s("div",null,[s("span",ns,o(e.plan),1)])]),s("td",null,o(l.formatDate(e.created_at)),1),s("td",null,[s("div",as,[(i(!0),a(f,null,w(e.meal_types,r=>(i(),a("span",{key:r,class:"badge badge-ghost"},o(r),1))),128))])]),s("td",null,[s("div",os,[(i(!0),a(f,null,w(e.days,r=>(i(),a("span",{key:r,class:"badge badge-accent"},o(r.substring(0,3)),1))),128))])]),s("td",is,o(l.formatPrice(e.total_price)),1),s("td",null,[s("span",{class:m(["badge",{"badge-success":e.status==="active","badge-warning":e.status==="paused","badge-error":e.status==="cancelled"}])},o(e.status||"active"),3)]),s("td",null,[s("div",rs,[s("button",{onClick:r=>l.viewDetails(e),class:"btn btn-ghost btn-xs"}," Details ",8,ds),e.status!=="paused"&&e.status!=="cancelled"?(i(),a("button",{key:0,onClick:r=>l.pauseSubscription(e),class:"btn btn-warning btn-xs"}," Pause ",8,cs)):v("",!0),e.status!=="cancelled"?(i(),a("button",{key:1,onClick:r=>l.cancelSubscription(e),class:"btn btn-error btn-xs"}," Cancel ",8,us)):v("",!0),e.status==="cancelled"?(i(),a("button",{key:2,onClick:r=>l.reactivateSubscription(e),class:"btn btn-success btn-xs"}," Reactivate ",8,bs)):v("",!0)])])]))),128))])])])):v("",!0)])])]),s("div",{class:m(["modal",{"modal-open":l.showDetailsModal}])},[s("div",vs,[t[33]||(t[33]=s("h3",{class:"font-bold text-2xl mb-4"},"Subscription Details",-1)),l.selectedSubscription?(i(),a("div",ms,[s("div",ps,[s("div",null,[t[20]||(t[20]=s("h4",{class:"font-bold text-lg"},"Customer Information",-1)),s("p",null,[t[17]||(t[17]=s("strong",null,"Name:",-1)),u(" "+o(l.selectedSubscription.name),1)]),s("p",null,[t[18]||(t[18]=s("strong",null,"Phone:",-1)),u(" "+o(l.selectedSubscription.phone),1)]),l.selectedSubscription.allergies?(i(),a("p",gs,[t[19]||(t[19]=s("strong",null,"Allergies:",-1)),u(" "+o(l.selectedSubscription.allergies),1)])):v("",!0)]),s("div",null,[t[25]||(t[25]=s("h4",{class:"font-bold text-lg"},"Plan Details",-1)),s("p",null,[t[21]||(t[21]=s("strong",null,"Plan:",-1)),s("span",fs,o(l.selectedSubscription.plan),1)]),s("p",null,[t[22]||(t[22]=s("strong",null,"Total Price:",-1)),u(" "+o(l.formatPrice(l.selectedSubscription.total_price)),1)]),s("p",null,[t[23]||(t[23]=s("strong",null,"Start Date:",-1)),u(" "+o(l.formatDate(l.selectedSubscription.created_at)),1)]),s("p",null,[t[24]||(t[24]=s("strong",null,"Status:",-1)),s("span",{class:m(["badge",{"badge-success":l.selectedSubscription.status==="active","badge-warning":l.selectedSubscription.status==="paused","badge-error":l.selectedSubscription.status==="cancelled"}])},o(l.selectedSubscription.status||"active"),3)])])]),t[31]||(t[31]=s("div",{class:"divider"},null,-1)),s("div",null,[t[26]||(t[26]=s("h4",{class:"font-bold text-lg mb-2"},"Delivery Schedule",-1)),s("div",ws,[(i(),a(f,null,w(["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],e=>s("div",{key:e,class:m(["text-center p-2 rounded border",{"bg-primary text-white":l.selectedSubscription.days.includes(e),"bg-base-200":!l.selectedSubscription.days.includes(e)}])},o(e.substring(0,3)),3)),64))])]),t[32]||(t[32]=s("div",{class:"divider"},null,-1)),s("div",null,[t[27]||(t[27]=s("h4",{class:"font-bold text-lg mb-2"},"Meal Types",-1)),s("div",ys,[(i(),a(f,null,w(["breakfast","lunch","dinner"],e=>s("div",{key:e,class:m(["badge badge-lg",{"badge-primary":l.selectedSubscription.meal_types.includes(e),"badge-ghost":!l.selectedSubscription.meal_types.includes(e)}])},o(e),3)),64))])]),l.selectedSubscription.pause_start&&l.selectedSubscription.pause_end?(i(),a("div",xs,[t[30]||(t[30]=s("h4",{class:"font-bold text-lg mb-2"},"Pause Information",-1)),s("p",null,[t[28]||(t[28]=s("strong",null,"Paused From:",-1)),u(" "+o(l.formatDate(l.selectedSubscription.pause_start)),1)]),s("p",null,[t[29]||(t[29]=s("strong",null,"Paused Until:",-1)),u(" "+o(l.formatDate(l.selectedSubscription.pause_end)),1)])])):v("",!0)])):v("",!0),s("div",ks,[s("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>l.closeDetailsModal&&l.closeDetailsModal(...e))},"Close")])])],2),s("div",{class:m(["modal",{"modal-open":l.showPauseModal}])},[s("div",Ss,[t[36]||(t[36]=s("h3",{class:"font-bold text-lg mb-4"},"Pause Subscription",-1)),t[37]||(t[37]=s("p",{class:"mb-4"},"Select the period when you want to pause your meal delivery:",-1)),s("div",hs,[t[34]||(t[34]=s("label",{class:"label"},[s("span",{class:"label-text"},"Pause from")],-1)),M(s("input",{type:"date",class:"input input-bordered w-full","onUpdate:modelValue":t[1]||(t[1]=e=>l.pauseDates.start=e),min:l.today},null,8,Ds),[[P,l.pauseDates.start]])]),s("div",Cs,[t[35]||(t[35]=s("label",{class:"label"},[s("span",{class:"label-text"},"Pause until")],-1)),M(s("input",{type:"date",class:"input input-bordered w-full","onUpdate:modelValue":t[2]||(t[2]=e=>l.pauseDates.end=e),min:l.pauseDates.start||l.today},null,8,Ms),[[P,l.pauseDates.end]])]),t[38]||(t[38]=s("div",{class:"alert alert-info mb-4"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("span",null,"While paused, no charges will be applied and deliveries will be suspended.")],-1)),s("div",Ps,[s("button",{class:"btn btn-ghost",onClick:t[3]||(t[3]=(...e)=>l.closePauseModal&&l.closePauseModal(...e))},"Cancel"),s("button",{class:"btn btn-warning",onClick:t[4]||(t[4]=(...e)=>l.confirmPause&&l.confirmPause(...e)),disabled:!l.isPauseValid}," Pause Subscription ",8,_s)])])],2),s("div",{class:m(["modal",{"modal-open":l.showCancelModal}])},[s("div",Rs,[t[40]||(t[40]=V('<h3 class="font-bold text-lg mb-4">Cancel Subscription</h3><p class="mb-4">Are you sure you want to cancel your subscription?</p><div class="alert alert-error mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>This action cannot be undone. Your meal delivery will stop immediately.</span></div>',3)),s("div",Bs,[t[39]||(t[39]=s("label",{class:"label"},[s("span",{class:"label-text"},"Please tell us why you're cancelling (optional)")],-1)),M(s("textarea",{class:"textarea textarea-bordered h-24","onUpdate:modelValue":t[5]||(t[5]=e=>l.cancellationReason=e)},null,512),[[P,l.cancellationReason]])]),s("div",Vs,[s("button",{class:"btn btn-ghost",onClick:t[6]||(t[6]=(...e)=>l.closeCancelModal&&l.closeCancelModal(...e))},"Go Back"),s("button",{class:"btn btn-error",onClick:t[7]||(t[7]=(...e)=>l.confirmCancel&&l.confirmCancel(...e))},"Confirm Cancellation")])])],2),s("div",{class:m(["modal",{"modal-open":l.showReactivateModal}])},[s("div",As,[t[41]||(t[41]=V('<h3 class="font-bold text-lg mb-4">Reactivate Subscription</h3><p class="mb-4">Would you like to reactivate your cancelled subscription?</p><div class="alert alert-success mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>Your meal delivery service will resume immediately upon reactivation.</span></div>',3)),s("div",Fs,[s("button",{class:"btn btn-ghost",onClick:t[8]||(t[8]=(...e)=>l.closeReactivateModal&&l.closeReactivateModal(...e))},"Cancel"),s("button",{class:"btn btn-success",onClick:t[9]||(t[9]=(...e)=>l.confirmReactivate&&l.confirmReactivate(...e))},"Confirm Reactivation")])])],2),S(k)])}const Us=Y(Q,[["render",Ns]]);export{Us as default};
